<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style></style>
    <title>Simple Monitoring Tool</title>
    <script defer="defer">
      (() => {
        "use strict";
        const t = 5e3;
        class e {
          constructor() {
            this.systemLogs = [];
          }
          addSystemLog = (e) => {
            this.systemLogs.length > t && this.systemLogs.pop(),
              this.systemLogs.unshift(e);
          };
          getSystemLogs = () => this.systemLogs;
        }
        class o {
          constructor(t) {
            (this.showRealtimeLogs = !0),
              (this.controller = t),
              (this.filterInput = document.getElementById("filterInput")),
              (this.findButton = document.getElementById("filterButton")),
              (this.logContainer = document.getElementById("logContainer")),
              (this.realtimeModeCheckbox = document.getElementById(
                "realtimeModeCheckbox",
              )),
              (this.tabButtons = document.querySelectorAll(".tab-button")),
              (this.tabContents = document.querySelectorAll(".tab-content"));
            const e = new WebSocket("ws://localhost:3001");
            (e.onopen = this.handleSocketOpen),
              (e.onmessage = this.handleSocketMessage),
              (e.onclose = this.handleSocketClose),
              (e.onerror = this.handleSocketError),
              this.findButton.addEventListener("click", this.handleFilterClick),
              this.realtimeModeCheckbox.addEventListener(
                "change",
                this.handleRealtimeLogsClick,
              ),
              this.tabButtons.forEach((t) => {
                t.addEventListener("click", this.handleTabClick);
              });
          }
          setRealTimeMode = (t) => {
            (this.showRealtimeLogs = t),
              (this.realtimeModeCheckbox.checked = this.showRealtimeLogs);
          };
          handleSocketOpen = () => {
            console.log("[open] Connection established");
          };
          handleSocketMessage = (t) => {
            const e = JSON.parse(t.data);
            (e.time = new Date(e.time).toISOString()),
              this.controller.addSystemLog(e);
            const o = this.controller.getSystemLogs();
            this.showRealtimeLogs && this.renderLogItemsList(o);
          };
          handleSocketClose = (t) => {
            t.wasClean
              ? console.log(
                  `[close] Connection closed cleanly, code=${t.code} reason=${t.reason}`,
                )
              : console.log("[close] Connection died");
          };
          handleSocketError = () => {
            console.log("[error]");
          };
          handleFilterClick = async (t) => {
            t.preventDefault();
            const e = this.filterInput.value;
            if (e.length) {
              const t = new URLSearchParams({ filter: e }).toString(),
                o = await fetch(`http://localhost:3000/logs?${t}`);
              if (!o.ok) throw new Error("Network error");
              const s = (await o.json()).map((t) => ({
                ...t,
                time: new Date(t.time).toISOString(),
              }));
              this.setRealTimeMode(!1), this.renderLogItemsList(s);
            }
          };
          handleRealtimeLogsClick = (t) => {
            if (!this.showRealtimeLogs) {
              const t = this.controller.getSystemLogs();
              this.renderLogItemsList(t);
            }
            const e = t.target.checked;
            this.setRealTimeMode(e);
          };
          renderLogItemsList = (t) => {
            const e = {},
              o = Array.from(this.logContainer.children);
            for (const t of o) {
              const o = t.dataset.time;
              e[o] = t;
            }
            const s = [];
            for (
              t.forEach((t) => {
                const o = e[t.time]
                  ? e[t.time]
                  : this.createLogItem(t.time, t.text);
                s.push(o);
              });
              this.logContainer.lastElementChild;

            )
              this.logContainer.removeChild(this.logContainer.lastElementChild);
            s.forEach((t) => {
              this.logContainer.appendChild(t);
            });
          };
          handleTabClick = (t) => {
            const e = t.target.getAttribute("data-tab");
            this.tabButtons.forEach((t) => t.classList.remove("active")),
              this.tabContents.forEach((t) => t.classList.remove("active")),
              t.target.classList.add("active"),
              document.getElementById(e).classList.add("active");
          };
          createLogItem = (t, e) => {
            const o = document.createElement("div");
            (o.className = "log-item"),
              (o.dataset.component = "log-item"),
              (o.dataset.key = t);
            const s = document.createElement("p");
            (s.className = "log-item_timestamp"), (s.textContent = t);
            const n = document.createElement("p");
            return (
              (n.className = "log-item_log-content"),
              (n.textContent = e),
              o.appendChild(s),
              o.appendChild(n),
              o
            );
          };
        }
        class s {
          constructor(t) {
            this.model = t;
          }
          addSystemLog = (t) => {
            this.model.addSystemLog(t);
          };
          getSystemLogs = () => this.model.getSystemLogs();
        }
        document.addEventListener("DOMContentLoaded", () => {
          const t = new e(),
            n = new s(t);
          new o(n);
        });
      })();
    </script>
    <style type="text/css">
      p {
        margin: 0;
      }
      #root {
        column-gap: 16px;
        display: flex;
      }
      .left-panel {
        flex: 1;
      }
      .navigation {
        display: flex;
        flex-direction: column;
        row-gap: 16px;
      }
      .tab-content {
        display: none;
        flex: 8;
      }
      .tab-content.active {
        display: block;
      }
      .tab-button.active {
        font-weight: 700;
      }
      .form {
        margin-bottom: 16px;
      }
      .form-filter {
        display: flex;
        margin-bottom: 8px;
      }
      .filter-input,
      .filter-label {
        margin-right: 8px;
      }
      .filter-input {
        width: 100%;
      }
      .log-item {
        display: flex;
        margin-bottom: 8px;
        p {
          font-size: 14px;
        }
      }
      .log-item_timestamp {
        margin-right: 16px;
        width: 180px;
      }
      .log-item_log-content {
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <div class="left-panel">
        <nav class="navigation">
          <button class="tab-button active" data-tab="tab1">Logs</button>
          <button class="tab-button" data-tab="tab2">Log Rotation</button>
        </nav>
      </div>
      <div class="tab-content active" id="tab1">
        <form class="form">
          <div class="form-filter">
            <label class="filter-label" for="filter">Filter:</label>
            <input
              class="filter-input"
              id="filterInput"
              name="filter"
              value='{ "level": 40 }'
            />
            <button id="filterButton">Find</button>
          </div>
          <div class="form-controls">
            <label for="realtime">Real-Time Logs:</label>
            <input
              id="realtimeModeCheckbox"
              type="checkbox"
              checked="checked"
            />
          </div>
        </form>
        <div class="log-container" id="logContainer"></div>
      </div>
      <div class="tab-content" id="tab2"></div>
    </div>
  </body>
</html>
